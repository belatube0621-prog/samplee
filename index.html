<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f3f4f6;
            --color-primary: #3b82f6;
            --color-secondary: #1e40af;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        .custom-bg {
            background-color: var(--bg-secondary);
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--color-secondary);
        }

        .notification {
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #ef4444;
            color: white;
            border-radius: 9999px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .menu-item-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .menu-item-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .panel-hidden {
            display: none;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }

        .status-preparing {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .status-ready {
            background-color: #d1fae5;
            color: #065f46;
        }

        .status-delivered {
            background-color: #e5e7eb;
            color: #374151;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="modal active">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-md w-full">
            <h2 class="text-3xl font-bold mb-6 text-center">Welcome</h2>
            
            <div class="space-y-4">
                <button onclick="selectRole('guest')" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-6 py-4 rounded-lg font-semibold text-lg">
                    <i class="fas fa-user mr-2"></i> Continue as Guest
                </button>
                
                <button onclick="selectRole('kitchen')" class="w-full bg-green-500 hover:bg-green-600 text-white px-6 py-4 rounded-lg font-semibold text-lg">
                    <i class="fas fa-utensils mr-2"></i> Kitchen Staff Login
                </button>
                
                <button onclick="selectRole('owner')" class="w-full bg-purple-500 hover:bg-purple-600 text-white px-6 py-4 rounded-lg font-semibold text-lg">
                    <i class="fas fa-crown mr-2"></i> Owner Login
                </button>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="authModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-md w-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold" id="authTitle">Login</h2>
                <button onclick="closeAuth()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Username</label>
                    <input type="text" id="authUsername" class="w-full px-4 py-2 border rounded-lg" placeholder="Enter username">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Password</label>
                    <input type="password" id="authPassword" class="w-full px-4 py-2 border rounded-lg" placeholder="Enter password">
                </div>
                <button onclick="authenticate()" class="w-full btn-primary px-4 py-3 rounded-lg font-semibold">
                    Login
                </button>
            </div>
        </div>
    </div>

    <!-- Table/Room Number Modal -->
    <div id="tableModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-md w-full max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold mb-6">Enter Your Location</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Table Number / Room Number</label>
                    <input type="text" id="tableNumber" class="w-full px-4 py-2 border rounded-lg" placeholder="e.g., Table 5 or Room 201">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Guest Name (Optional)</label>
                    <input type="text" id="guestName" class="w-full px-4 py-2 border rounded-lg" placeholder="Your name">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Allergies & Preferences</label>
                    <textarea id="guestPreferences" class="w-full px-4 py-2 border rounded-lg" rows="3" placeholder="Please mention any food allergies, dietary restrictions, or special preferences (e.g., no nuts, vegetarian, extra spicy, etc.)"></textarea>
                    <p class="text-xs text-gray-500 mt-1">This information will be shared with the kitchen staff</p>
                </div>
                <button onclick="confirmTable()" class="w-full btn-primary px-4 py-3 rounded-lg font-semibold">
                    Confirm & Place Order
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal (Owner Only) -->
    <div id="settingsModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Settings & Customization</h2>
                <button onclick="closeSettings()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <!-- Change Credentials (Owner/Kitchen) -->
            <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <h3 class="text-lg font-semibold mb-3">Change Login Credentials</h3>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium mb-1">New Username</label>
                        <input type="text" id="newUsername" class="w-full px-3 py-2 border rounded-lg" placeholder="Enter new username">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">New Password</label>
                        <input type="password" id="newPassword" class="w-full px-3 py-2 border rounded-lg" placeholder="Enter new password">
                    </div>
                    <button onclick="changeCredentials()" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold">
                        Update Credentials
                    </button>
                </div>
            </div>

            <!-- Restaurant Info -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3">Restaurant Information</h3>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium mb-1">Restaurant Name</label>
                        <input type="text" id="restaurantName" class="w-full px-3 py-2 border rounded-lg" placeholder="Enter restaurant name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Address</label>
                        <input type="text" id="restaurantAddress" class="w-full px-3 py-2 border rounded-lg" placeholder="Enter address">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Logo URL</label>
                        <input type="text" id="logoUrl" class="w-full px-3 py-2 border rounded-lg" placeholder="Enter logo URL">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Upload Logo</label>
                        <input type="file" id="logoUpload" accept="image/*" class="w-full px-3 py-2 border rounded-lg">
                    </div>
                </div>
            </div>

            <!-- Social Media Links -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3">Social Media</h3>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium mb-1"><i class="fab fa-facebook"></i> Facebook</label>
                        <input type="text" id="facebookUrl" class="w-full px-3 py-2 border rounded-lg" placeholder="Facebook URL">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1"><i class="fab fa-instagram"></i> Instagram</label>
                        <input type="text" id="instagramUrl" class="w-full px-3 py-2 border rounded-lg" placeholder="Instagram URL">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1"><i class="fab fa-twitter"></i> Twitter</label>
                        <input type="text" id="twitterUrl" class="w-full px-3 py-2 border rounded-lg" placeholder="Twitter URL">
                    </div>
                </div>
            </div>

            <!-- Color Customization -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3">Color Theme</h3>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium mb-1">Primary Color</label>
                        <input type="color" id="primaryColor" class="w-full h-10 border rounded-lg cursor-pointer">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Secondary Color</label>
                        <input type="color" id="secondaryColor" class="w-full h-10 border rounded-lg cursor-pointer">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Background Color</label>
                        <input type="color" id="bgColor" class="w-full h-10 border rounded-lg cursor-pointer">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Secondary BG Color</label>
                        <input type="color" id="bgSecondaryColor" class="w-full h-10 border rounded-lg cursor-pointer">
                    </div>
                </div>
            </div>

            <!-- Background Image -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-3">Background Image</h3>
                <input type="file" id="bgImageUpload" accept="image/*" class="w-full px-3 py-2 border rounded-lg mb-2">
                <button onclick="removeBgImage()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                    Remove Background Image
                </button>
            </div>

            <button onclick="saveSettings()" class="w-full btn-primary px-4 py-3 rounded-lg font-semibold">
                Save Settings
            </button>
        </div>
    </div>

    <!-- Menu Management Modal (Owner Only) -->
    <div id="menuManagementModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Menu Management</h2>
                <button onclick="closeMenuManagement()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <button onclick="showAddMenuItem()" class="btn-primary px-6 py-3 rounded-lg font-semibold">
                    <i class="fas fa-plus mr-2"></i> Add New Menu Item
                </button>
            </div>

            <div id="menuItemsList" class="space-y-4"></div>
        </div>
    </div>

    <!-- Add/Edit Menu Item Modal -->
    <div id="menuItemModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold" id="menuItemModalTitle">Add Menu Item</h2>
                <button onclick="closeMenuItemModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Image Upload</label>
                    <input type="file" id="menuItemImage" accept="image/*" class="w-full px-3 py-2 border rounded-lg">
                    <img id="menuItemImagePreview" class="mt-2 max-h-48 rounded-lg hidden">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Category</label>
                    <select id="menuItemCategory" class="w-full px-3 py-2 border rounded-lg">
                        <option value="appetizers">Appetizers</option>
                        <option value="mains">Main Courses</option>
                        <option value="desserts">Desserts</option>
                        <option value="beverages">Beverages</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Price ($)</label>
                    <input type="number" id="menuItemPrice" step="0.01" class="w-full px-3 py-2 border rounded-lg" placeholder="0.00">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Name (English)</label>
                    <input type="text" id="menuItemNameEn" class="w-full px-3 py-2 border rounded-lg" placeholder="Item name">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Description (English)</label>
                    <textarea id="menuItemDescEn" class="w-full px-3 py-2 border rounded-lg" rows="2" placeholder="Description"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Name (Amharic)</label>
                    <input type="text" id="menuItemNameAm" class="w-full px-3 py-2 border rounded-lg" placeholder="á‹¨áˆáŒá‰¥ áˆµáˆ">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Description (Amharic)</label>
                    <textarea id="menuItemDescAm" class="w-full px-3 py-2 border rounded-lg" rows="2" placeholder="×ª×™××•×¨"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Name (Afan Oromo)</label>
                    <input type="text" id="menuItemNameOm" class="w-full px-3 py-2 border rounded-lg" placeholder="Maqaa Nyaataa">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Description (Afan Oromo)</label>
                    <textarea id="menuItemDescOm" class="w-full px-3 py-2 border rounded-lg" rows="2" placeholder="Ibsa"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Tags</label>
                    <input type="text" id="menuItemTags" class="w-full px-3 py-2 border rounded-lg" placeholder="e.g., Vegetarian, Gluten-Free, Spicy, Vegan (comma separated)">
                    <p class="text-xs text-gray-500 mt-1">Add tags for dietary information and preferences</p>
                </div>
                <button onclick="saveMenuItem()" class="w-full btn-primary px-4 py-3 rounded-lg font-semibold">
                    Save Menu Item
                </button>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Shopping Cart</h2>
                <button onclick="closeCart()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div id="cartItems" class="space-y-4 mb-6"></div>
            <div class="border-t pt-4">
                <div class="flex justify-between text-xl font-bold mb-4">
                    <span>Total:</span>
                    <span id="cartTotal">$0.00</span>
                </div>
                <button onclick="proceedToOrder()" class="w-full btn-primary px-4 py-3 rounded-lg font-semibold">
                    Proceed to Order
                </button>
            </div>
        </div>
    </div>

    <!-- Order History Modal -->
    <div id="orderHistoryModal" class="modal">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Order History</h2>
                <button onclick="closeOrderHistory()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div id="orderHistoryItems" class="space-y-4"></div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2" style="max-width: 350px;"></div>

    <!-- Main App Container -->
    <div id="appContainer" class="panel-hidden">
        <!-- Header -->
        <header class="custom-bg shadow-md sticky top-0 z-40">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <img id="restaurantLogo" src="https://via.placeholder.com/50" alt="Logo" class="h-12 w-12 object-cover rounded-full">
                        <div>
                            <h1 id="headerName" class="text-2xl font-bold">Restaurant Name</h1>
                            <p id="headerAddress" class="text-sm text-gray-600">Address</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Language Selector -->
                        <select id="languageSelector" onchange="changeLanguage()" class="px-3 py-2 border rounded-lg">
                            <option value="en">English</option>
                            <option value="am">áŠ áˆ›áˆ­áŠ›</option>
                            <option value="om">Afan Oromo</option>
                        </select>
                        
                        <!-- Role-specific buttons -->
                        <div id="guestButtons" class="hidden flex items-center space-x-4">
                            <button onclick="openCart()" class="relative">
                                <i class="fas fa-shopping-cart text-2xl"></i>
                                <span id="cartCount" class="cart-badge">0</span>
                            </button>
                            <button onclick="openOrderHistory()" class="text-2xl" title="Order History">
                                <i class="fas fa-history"></i>
                            </button>
                        </div>

                        <div id="ownerButtons" class="hidden flex items-center space-x-4">
                            <button onclick="openSettings()" class="text-2xl" title="Settings">
                                <i class="fas fa-cog"></i>
                            </button>
                            <button onclick="openMenuManagement()" class="text-2xl" title="Menu Management">
                                <i class="fas fa-utensils"></i>
                            </button>
                            <button onclick="openOrderHistory()" class="text-2xl" title="All Orders">
                                <i class="fas fa-clipboard-list"></i>
                            </button>
                        </div>

                        <div id="kitchenButtons" class="hidden flex items-center space-x-4">
                             <button onclick="openOrderHistory()" class="text-2xl" title="Orders">
                                <i class="fas fa-clipboard-list"></i>
                            </button>
                        </div>
                        
                        <button onclick="logout()" class="text-2xl" title="Logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Guest Panel -->
        <div id="guestPanel" class="panel-hidden">
            <main class="container mx-auto px-4 py-8">
                <!-- Category Filter -->
                <div class="mb-8">
                    <div class="flex flex-wrap gap-3">
                        <button onclick="filterCategory('all')" class="category-btn btn-primary px-6 py-2 rounded-full font-semibold">
                            All
                        </button>
                        <button onclick="filterCategory('appetizers')" class="category-btn bg-gray-200 px-6 py-2 rounded-full font-semibold hover:bg-gray-300">
                            Appetizers
                        </button>
                        <button onclick="filterCategory('mains')" class="category-btn bg-gray-200 px-6 py-2 rounded-full font-semibold hover:bg-gray-300">
                            Main Courses
                        </button>
                        <button onclick="filterCategory('desserts')" class="category-btn bg-gray-200 px-6 py-2 rounded-full font-semibold hover:bg-gray-300">
                            Desserts
                        </button>
                        <button onclick="filterCategory('beverages')" class="category-btn bg-gray-200 px-6 py-2 rounded-full font-semibold hover:bg-gray-300">
                            Beverages
                        </button>
                    </div>
                </div>

                <!-- Search Bar -->
                <div class="mb-8">
                    <div class="relative">
                        <input type="text" id="searchInput" onkeyup="searchMenu()" placeholder="Search menu..." class="w-full px-4 py-3 pl-12 border rounded-lg">
                        <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
                    </div>
                </div>

                <!-- Menu Items -->
                <div id="menuContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                </div>
            </main>
        </div>

        <!-- Kitchen Panel -->
        <div id="kitchenDashboard" class="panel-hidden">
            <main class="container mx-auto px-4 py-8">
                <h2 class="text-3xl font-bold mb-6">Kitchen Dashboard</h2>
                
                <div class="mb-6 flex gap-4">
                    <input type="text" id="kitchenNotificationInput" placeholder="Send notification to guests..." class="flex-1 px-4 py-3 border rounded-lg">
                    <button onclick="sendKitchenNotification()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold">
                        <i class="fas fa-paper-plane mr-2"></i> Send Notification
                    </button>
                </div>

                <div id="kitchenOrders" class="space-y-4"></div>
            </main>
        </div>

        <!-- Owner Panel -->
        <div id="ownerDashboard" class="panel-hidden">
            <main class="container mx-auto px-4 py-8">
                <h2 class="text-3xl font-bold mb-6">Owner Dashboard</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-blue-100 p-6 rounded-lg">
                        <div class="text-3xl font-bold text-blue-600" id="totalOrders">0</div>
                        <div class="text-gray-600">Total Orders</div>
                    </div>
                    <div class="bg-yellow-100 p-6 rounded-lg">
                        <div class="text-3xl font-bold text-yellow-600" id="pendingOrders">0</div>
                        <div class="text-gray-600">Pending Orders</div>
                    </div>
                    <div class="bg-green-100 p-6 rounded-lg">
                        <div class="text-3xl font-bold text-green-600" id="completedOrders">0</div>
                        <div class="text-gray-600">Completed Orders</div>
                    </div>
                    <div class="bg-purple-100 p-6 rounded-lg">
                        <div class="text-3xl font-bold text-purple-600" id="totalRevenue">$0</div>
                        <div class="text-gray-600">Total Revenue</div>
                    </div>
                </div>

                <div class="mb-6">
                    <input type="text" id="ownerNotificationInput" placeholder="Send notification to all users..." class="flex-1 px-4 py-3 border rounded-lg w-full mb-4">
                    <button onclick="sendOwnerNotification()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold">
                        <i class="fas fa-bullhorn mr-2"></i> Broadcast Notification
                    </button>
                </div>

                <div id="ownerOrders" class="space-y-4"></div>
            </main>
        </div>

        <!-- Footer -->
        <footer class="custom-bg mt-16 py-8">
            <div class="container mx-auto px-4 text-center">
                <div id="footerSocial" class="flex justify-center space-x-6 mb-4"></div>
                <p class="text-gray-600">&copy; 2024 <span id="footerName">Restaurant Name</span>. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <script>
        // ===== FIREBASE CONFIGURATION =====
        const firebaseConfig = {
          apiKey: "AIzaSyDk8-LpaUnWm20NyahGdwxianUFBbHAf7o",
          authDomain: "restaurant-management-cef63.firebaseapp.com",
          databaseURL: "https://restaurant-management-cef63-default-rtdb.firebaseio.com",
          projectId: "restaurant-management-cef63",
          storageBucket: "restaurant-management-cef63.appspot.com",
          messagingSenderId: "892182214266",
          appId: "1:892182214266:web:1e96b2e9bdb8229b86adc3",
          measurementId: "G-265YJH1RPC"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Translations
        const translations = {
            en: {
                all: 'All',
                appetizers: 'Appetizers',
                mains: 'Main Courses',
                desserts: 'Desserts',
                beverages: 'Beverages',
                addToCart: 'Add to Cart',
                cart: 'Cart',
                total: 'Total',
                placeOrder: 'Place Order',
                orderHistory: 'Order History',
                searchPlaceholder: 'Search menu...',
                orderPlaced: 'Order placed successfully!',
                pending: 'Pending',
                preparing: 'Preparing',
                ready: 'Ready',
                delivered: 'Delivered'
            },
            am: {
                all: 'áˆáˆ‰áˆ',
                appetizers: 'áŠ áˆµáŒ€áˆ›áˆª',
                mains: 'á‹‹áŠ“ á‹‹áŠ“ áˆáŒá‰¦á‰½',
                desserts: 'áŒ£á‹áŒ®á‰½',
                beverages: 'áˆ˜áŒ áŒ¦á‰½',
                addToCart: 'á‹ˆá‹° áŒ‹áˆª áŠ áŠ­áˆ',
                cart: 'áŒ‹áˆª',
                total: 'áŒ á‰…áˆ‹áˆ‹',
                placeOrder: 'á‰µá‹•á‹›á‹ á‹­áˆµáŒ¡',
                orderHistory: 'á‹¨á‰µá‹•á‹›á‹ á‰³áˆªáŠ­',
                searchPlaceholder: 'áˆáŠ“áˆŒ á‹­áˆáˆáŒ‰...',
                orderPlaced: 'á‰µá‹•á‹›á‹™ á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°áˆ°áŒ¥á‰·áˆ!',
                pending: 'á‰ áˆ˜áŒ á‰£á‰ á‰… áˆ‹á‹­',
                preparing: 'á‰ áˆ˜á‹˜áŒ‹áŒ€á‰µ áˆ‹á‹­',
                ready: 'á‹áŒáŒ',
                delivered: 'á‹°áˆ¨áˆ°'
            },
            om: {
                all: 'Hundaa',
                appetizers: 'Nyaata Jalqabaa',
                mains: 'Nyaata Guddaa',
                desserts: 'Mi'eessitii',
                beverages: 'Dhugaatiiwwan',
                addToCart: 'Gara Gabatee',
                cart: 'Gabatee',
                total: 'Ida'ama',
                placeOrder: 'Ajaja Kenni',
                orderHistory: 'Seenaa Ajajaa',
                searchPlaceholder: 'Gabatee Nyaataa Barbaadi...',
                orderPlaced: 'Ajajni Milkaa'inaan Kennameera!',
                pending: 'Eegamaa Jira',
                preparing: 'Qophaa'aa Jira',
                ready: 'Qophaa'eera',
                delivered: 'Geessameera'
            }
        };

        // State
        let currentLanguage = 'en';
        let currentRole = null;
        let currentAuthRole = null;
        let cart = [];
        let orderHistory = [];
        let currentCategory = 'all';
        let editingMenuItemId = null;
        
        let settings = {};
        let credentials = {};
        let menuItems = [];
        let lastOrderCount = 0;

        // ===== NOTIFICATION SOUND =====
        function playNotificationSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800; // A clear beep
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // ===== DATA HANDLING (FIREBASE) =====
        function loadCredentials() {
            db.ref('credentials').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    credentials = data;
                } else {
                    // Set default credentials if none exist in DB
                    credentials = {
                        owner: { username: 'admin', password: 'admin123' },
                        kitchen: { username: 'kitchen', password: 'kitchen123' }
                    };
                    db.ref('credentials').set(credentials);
                }
            });
        }

        function saveCredentials() {
            db.ref('credentials').set(credentials);
        }

        function loadSettings() {
            db.ref('settings').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    settings = data;
                } else {
                    // Default settings
                    settings = {
                        restaurantName: 'Gourmet Restaurant',
                        address: '123 Main Street, City, Country',
                        logoUrl: 'https://via.placeholder.com/150',
                        social: { facebook: '', instagram: '', twitter: '' },
                        colors: { primary: '#3b82f6', secondary: '#1e40af', bgPrimary: '#ffffff', bgSecondary: '#f3f4f6' }
                    };
                }
                applySettings();
            });
        }
        
        function saveSettings() {
            settings.restaurantName = document.getElementById('restaurantName').value;
            settings.address = document.getElementById('restaurantAddress').value;
            settings.logoUrl = document.getElementById('logoUrl').value;
            settings.social.facebook = document.getElementById('facebookUrl').value;
            settings.social.instagram = document.getElementById('instagramUrl').value;
            settings.social.twitter = document.getElementById('twitterUrl').value;
            settings.colors.primary = document.getElementById('primaryColor').value;
            settings.colors.secondary = document.getElementById('secondaryColor').value;
            settings.colors.bgPrimary = document.getElementById('bgColor').value;
            settings.colors.bgSecondary = document.getElementById('bgSecondaryColor').value;
            
            db.ref('settings').set(settings);
            closeSettings();
            showNotification('Settings saved successfully!', 'success');
        }

        function loadMenuItems() {
            db.ref('menuItems').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    menuItems = data;
                }
                renderMenu();
                if (currentRole === 'owner') {
                    renderMenuItemsList();
                }
            });
        }

        function saveMenuItems() {
            db.ref('menuItems').set(menuItems);
        }

        function loadOrderHistory() {
            db.ref('orders').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    orderHistory = Object.values(data).sort((a, b) => b.id - a.id);
                } else {
                    orderHistory = [];
                }
                
                // New order check for kitchen
                if (currentRole === 'kitchen') {
                    const activeOrdersCount = orderHistory.filter(o => o.status !== 'delivered').length;
                    if (lastOrderCount > 0 && activeOrdersCount > lastOrderCount) {
                        playNotificationSound();
                        showNotification('ðŸ”” NEW ORDER RECEIVED!', 'success', 5000);
                    }
                    lastOrderCount = activeOrdersCount;
                }
                
                if (document.getElementById('orderHistoryModal').classList.contains('active')) {
                    renderOrderHistory();
                }
                if (currentRole === 'kitchen') {
                    renderKitchenOrders();
                }
                if (currentRole === 'owner') {
                    updateOwnerStats();
                    renderOwnerOrders();
                }
            });
        }
        
        function confirmTable() {
            const tableNumber = document.getElementById('tableNumber').value;
            const guestName = document.getElementById('guestName').value;
            const preferences = document.getElementById('guestPreferences').value;
            
            if (!tableNumber) {
                showNotification('Please enter table/room number', 'error');
                return;
            }
            
            const orderId = Date.now();
            const order = {
                id: orderId,
                items: [...cart],
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                date: new Date().toLocaleString(),
                status: 'pending',
                tableNumber: tableNumber,
                guestName: guestName || 'Guest',
                preferences: preferences || '',
                language: currentLanguage
            };
            
            db.ref('orders/' + orderId).set(order);

            cart = [];
            updateCartCount();
            document.getElementById('tableModal').classList.remove('active');
            document.getElementById('tableNumber').value = '';
            document.getElementById('guestName').value = '';
            document.getElementById('guestPreferences').value = '';
            
            const lang = translations[currentLanguage];
            showNotification(lang.orderPlaced, 'success');
        }

        function updateOrderStatus(orderId, newStatus) {
            db.ref('orders/' + orderId).update({ status: newStatus });
        }


        // ===== INITIALIZATION =====
        function init() {
            loadCredentials();
            loadSettings();
            loadMenuItems();
            loadOrderHistory();
        }

        // Role Selection
        function selectRole(role) {
            if (role === 'guest') {
                currentRole = 'guest';
                document.getElementById('loginModal').classList.remove('active');
                showGuestPanel();
            } else {
                currentAuthRole = role;
                document.getElementById('loginModal').classList.remove('active');
                document.getElementById('authModal').classList.add('active');
                document.getElementById('authTitle').textContent = role === 'owner' ? 'Owner Login' : 'Kitchen Staff Login';
            }
        }

        // Authentication
        function authenticate() {
            const username = document.getElementById('authUsername').value;
            const password = document.getElementById('authPassword').value;
            
            if (credentials[currentAuthRole].username === username && credentials[currentAuthRole].password === password) {
                currentRole = currentAuthRole;
                closeAuth();
                
                if (currentRole === 'owner') {
                    showOwnerPanel();
                } else if (currentRole === 'kitchen') {
                    showKitchenPanel();
                    // Initialize order count for kitchen user
                    lastOrderCount = orderHistory.filter(o => o.status !== 'delivered').length;
                }
                
                showNotification('Login successful!', 'success');
            } else {
                showNotification('Invalid credentials!', 'error');
            }
        }

        function closeAuth() {
            document.getElementById('authModal').classList.remove('active');
            document.getElementById('authUsername').value = '';
            document.getElementById('authPassword').value = '';
        }

        // Panel Management
        function showGuestPanel() {
            document.getElementById('appContainer').classList.remove('panel-hidden');
            document.getElementById('guestPanel').classList.remove('panel-hidden');
            document.getElementById('guestButtons').classList.remove('hidden');
            document.getElementById('guestButtons').classList.add('flex');
            document.getElementById('kitchenDashboard').classList.add('panel-hidden');
            document.getElementById('ownerDashboard').classList.add('panel-hidden');
            renderMenu();
        }

        function showKitchenPanel() {
            document.getElementById('appContainer').classList.remove('panel-hidden');
            document.getElementById('kitchenDashboard').classList.remove('panel-hidden');
            document.getElementById('kitchenButtons').classList.remove('hidden');
            document.getElementById('kitchenButtons').classList.add('flex');
            document.getElementById('guestPanel').classList.add('panel-hidden');
            document.getElementById('ownerDashboard').classList.add('panel-hidden');
            renderKitchenOrders();
        }

        function showOwnerPanel() {
            document.getElementById('appContainer').classList.remove('panel-hidden');
            document.getElementById('ownerDashboard').classList.remove('panel-hidden');
            document.getElementById('ownerButtons').classList.remove('hidden');
            document.getElementById('ownerButtons').classList.add('flex');
            document.getElementById('guestPanel').classList.add('panel-hidden');
            document.getElementById('kitchenDashboard').classList.add('panel-hidden');
            updateOwnerStats();
            renderOwnerOrders();
        }

        function logout() {
            currentRole = null;
            currentAuthRole = null;
            cart = [];
            document.getElementById('appContainer').classList.add('panel-hidden');
            document.getElementById('guestPanel').classList.add('panel-hidden');
            document.getElementById('kitchenDashboard').classList.add('panel-hidden');
            document.getElementById('ownerDashboard').classList.add('panel-hidden');
            document.getElementById('guestButtons').classList.add('hidden');
            document.getElementById('kitchenButtons').classList.add('hidden');
            document.getElementById('ownerButtons').classList.add('hidden');
            document.getElementById('loginModal').classList.add('active');
            updateCartCount();
        }

        // Settings Management
        function applySettings() {
            document.getElementById('headerName').textContent = settings.restaurantName || 'Restaurant Name';
            document.getElementById('headerAddress').textContent = settings.address || 'Address';
            document.getElementById('footerName').textContent = settings.restaurantName || 'Restaurant Name';
            document.getElementById('restaurantLogo').src = settings.logoUrl || 'https://via.placeholder.com/150';
            
            if (settings.colors) {
                document.documentElement.style.setProperty('--color-primary', settings.colors.primary);
                document.documentElement.style.setProperty('--color-secondary', settings.colors.secondary);
                document.documentElement.style.setProperty('--bg-primary', settings.colors.bgPrimary);
                document.documentElement.style.setProperty('--bg-secondary', settings.colors.bgSecondary);
            }
            
            updateSocialMedia();
        }

        function updateSocialMedia() {
            const socialContainer = document.getElementById('footerSocial');
            let socialHTML = '';
            
            if (settings.social?.facebook) {
                socialHTML += `<a href="${settings.social.facebook}" target="_blank" class="text-2xl hover:opacity-70"><i class="fab fa-facebook"></i></a>`;
            }
            if (settings.social?.instagram) {
                socialHTML += `<a href="${settings.social.instagram}" target="_blank" class="text-2xl hover:opacity-70"><i class="fab fa-instagram"></i></a>`;
            }
            if (settings.social?.twitter) {
                socialHTML += `<a href="${settings.social.twitter}" target="_blank" class="text-2xl hover:opacity-70"><i class="fab fa-twitter"></i></a>`;
            }
            
            socialContainer.innerHTML = socialHTML;
        }

        function openSettings() {
            if (currentRole !== 'owner') {
                showNotification('Only owner can access settings', 'error');
                return;
            }
            
            document.getElementById('settingsModal').classList.add('active');
            document.getElementById('restaurantName').value = settings.restaurantName || '';
            document.getElementById('restaurantAddress').value = settings.address || '';
            document.getElementById('logoUrl').value = settings.logoUrl || '';
            document.getElementById('facebookUrl').value = settings.social?.facebook || '';
            document.getElementById('instagramUrl').value = settings.social?.instagram || '';
            document.getElementById('twitterUrl').value = settings.social?.twitter || '';
            document.getElementById('primaryColor').value = settings.colors?.primary || '#3b82f6';
            document.getElementById('secondaryColor').value = settings.colors?.secondary || '#1e40af';
            document.getElementById('bgColor').value = settings.colors?.bgPrimary || '#ffffff';
            document.getElementById('bgSecondaryColor').value = settings.colors?.bgSecondary || '#f3f4f6';
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        // Change Credentials
        function changeCredentials() {
            const newUsername = document.getElementById('newUsername').value;
            const newPassword = document.getElementById('newPassword').value;
            
            if (!newUsername || !newPassword) {
                showNotification('Please enter both username and password', 'error');
                return;
            }
            
            if (currentRole === 'owner' || currentRole === 'kitchen') {
                 db.ref('credentials/' + currentRole).update({
                    username: newUsername,
                    password: newPassword
                 });
                 document.getElementById('newUsername').value = '';
                 document.getElementById('newPassword').value = '';
                 showNotification('Credentials updated successfully!', 'success');
            }
        }
        
        // Menu Management
        function openMenuManagement() {
            if (currentRole !== 'owner') {
                showNotification('Only owner can manage menu', 'error');
                return;
            }
            
            document.getElementById('menuManagementModal').classList.add('active');
            renderMenuItemsList();
        }

        function closeMenuManagement() {
            document.getElementById('menuManagementModal').classList.remove('active');
        }

        function renderMenuItemsList() {
            const container = document.getElementById('menuItemsList');
            if (!container) return;
            
            container.innerHTML = menuItems.map(item => `
                <div class="border rounded-lg p-4 flex items-center gap-4">
                    <img src="${item.image}" class="w-24 h-24 object-cover rounded-lg">
                    <div class="flex-1">
                        <h3 class="font-bold text-lg">${item.translations.en.name}</h3>
                        <p class="text-gray-600">${item.translations.en.description}</p>
                        ${item.tags ? `<p class="text-sm text-blue-600 mt-1"><i class="fas fa-tags"></i> ${item.tags}</p>` : ''}
                        <p class="text-lg font-semibold mt-2" style="color: var(--color-primary)">$${item.price.toFixed(2)}</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editMenuItem(${item.id})" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteMenuItem(${item.id})" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function showAddMenuItem() {
            editingMenuItemId = null;
            document.getElementById('menuItemModalTitle').textContent = 'Add Menu Item';
            document.getElementById('menuItemModal').classList.add('active');
            clearMenuItemForm();
        }

        function editMenuItem(id) {
            editingMenuItemId = id;
            const item = menuItems.find(i => i.id === id);
            if (!item) return;

            document.getElementById('menuItemModalTitle').textContent = 'Edit Menu Item';
            document.getElementById('menuItemCategory').value = item.category;
            document.getElementById('menuItemPrice').value = item.price;
            document.getElementById('menuItemNameEn').value = item.translations.en.name;
            document.getElementById('menuItemDescEn').value = item.translations.en.description;
            document.getElementById('menuItemNameAm').value = item.translations.am.name;
            document.getElementById('menuItemDescAm').value = item.translations.am.description;
            document.getElementById('menuItemNameOm').value = item.translations.om.name;
            document.getElementById('menuItemDescOm').value = item.translations.om.description;
            document.getElementById('menuItemTags').value = item.tags || '';
            
            if (item.image) {
                document.getElementById('menuItemImagePreview').src = item.image;
                document.getElementById('menuItemImagePreview').classList.remove('hidden');
            }
            
            document.getElementById('menuItemModal').classList.add('active');
        }

        function deleteMenuItem(id) {
            if (confirm('Are you sure you want to delete this menu item?')) {
                const updatedMenuItems = menuItems.filter(item => item.id !== id);
                db.ref('menuItems').set(updatedMenuItems);
                showNotification('Menu item deleted', 'success');
            }
        }

        function clearMenuItemForm() {
            document.getElementById('menuItemCategory').value = 'appetizers';
            document.getElementById('menuItemPrice').value = '';
            document.getElementById('menuItemNameEn').value = '';
            document.getElementById('menuItemDescEn').value = '';
            document.getElementById('menuItemNameAm').value = '';
            document.getElementById('menuItemDescAm').value = '';
            document.getElementById('menuItemNameOm').value = '';
            document.getElementById('menuItemDescOm').value = '';
            document.getElementById('menuItemTags').value = '';
            document.getElementById('menuItemImage').value = '';
            document.getElementById('menuItemImagePreview').classList.add('hidden');
        }

        function closeMenuItemModal() {
            document.getElementById('menuItemModal').classList.remove('active');
            clearMenuItemForm();
        }

        function saveMenuItem() {
            const id = editingMenuItemId || Date.now();
            const newItem = {
                id: id,
                category: document.getElementById('menuItemCategory').value,
                price: parseFloat(document.getElementById('menuItemPrice').value),
                image: document.getElementById('menuItemImagePreview').src || 'https://via.placeholder.com/400',
                tags: document.getElementById('menuItemTags').value,
                translations: {
                    en: { name: document.getElementById('menuItemNameEn').value, description: document.getElementById('menuItemDescEn').value },
                    am: { name: document.getElementById('menuItemNameAm').value, description: document.getElementById('menuItemDescAm').value },
                    om: { name: document.getElementById('menuItemNameOm').value, description: document.getElementById('menuItemDescOm').value }
                }
            };
            
            const updatedMenuItems = [...menuItems];
            if (editingMenuItemId) {
                const index = updatedMenuItems.findIndex(i => i.id === editingMenuItemId);
                updatedMenuItems[index] = newItem;
            } else {
                updatedMenuItems.push(newItem);
            }
            
            db.ref('menuItems').set(updatedMenuItems);
            closeMenuItemModal();
            showNotification('Menu item saved!', 'success');
        }

        // Menu Rendering
        function renderMenu() {
            const container = document.getElementById('menuContainer');
            if(!container) return;

            const lang = translations[currentLanguage];
            
            const filtered = currentCategory === 'all' 
                ? menuItems 
                : menuItems.filter(item => item.category === currentCategory);
            
            container.innerHTML = filtered.map(item => {
                const itemData = item.translations[currentLanguage] || item.translations.en;
                return `
                    <div class="menu-item-card bg-white rounded-lg shadow-md overflow-hidden fade-in" data-category="${item.category}" data-name="${item.translations.en.name.toLowerCase()}">
                        <img src="${item.image}" alt="${itemData.name}" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <h3 class="text-xl font-bold mb-2">${itemData.name}</h3>
                            <p class="text-gray-600 mb-3">${itemData.description}</p>
                            ${item.tags ? `<p class="text-xs text-blue-600 mb-2"><i class="fas fa-tags"></i> ${item.tags}</p>` : ''}
                            <div class="flex justify-between items-center">
                                <span class="text-2xl font-bold" style="color: var(--color-primary)">$${item.price.toFixed(2)}</span>
                                <button onclick="addToCart(${item.id})" class="btn-primary px-4 py-2 rounded-lg font-semibold">
                                    ${lang.addToCart}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterCategory(category) {
            currentCategory = category;
            
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('bg-gray-200', 'hover:bg-gray-300');
            });
            event.target.classList.remove('bg-gray-200', 'hover:bg-gray-300');
            event.target.classList.add('btn-primary');
            
            renderMenu();
        }

        function searchMenu() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.menu-item-card').forEach(card => {
                const name = card.dataset.name;
                card.style.display = name.includes(searchTerm) ? 'block' : 'none';
            });
        }

        // Cart Management
        function addToCart(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            if (!item) return;

            const itemData = item.translations[currentLanguage] || item.translations.en;
            
            const cartItem = cart.find(i => i.id === itemId);
            if (cartItem) {
                cartItem.quantity++;
            } else {
                cart.push({ id: itemId, name: itemData.name, price: item.price, quantity: 1 });
            }
            
            updateCartCount();
            showNotification(`${itemData.name} added to cart!`, 'success');
        }

        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
        }

        function openCart() {
            document.getElementById('cartModal').classList.add('active');
            renderCart();
        }

        function closeCart() {
            document.getElementById('cartModal').classList.remove('active');
        }

        function renderCart() {
            const container = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Your cart is empty</p>';
                document.getElementById('cartTotal').textContent = '$0.00';
                return;
            }
            
            container.innerHTML = cart.map(item => `
                <div class="flex justify-between items-center border-b pb-3">
                    <div class="flex-1">
                        <h4 class="font-semibold">${item.name}</h4>
                        <p class="text-gray-600">$${item.price.toFixed(2)} x ${item.quantity}</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button onclick="updateQuantity(${item.id}, -1)" class="bg-gray-200 px-3 py-1 rounded">-</button>
                        <span class="font-semibold">${item.quantity}</span>
                        <button onclick="updateQuantity(${item.id}, 1)" class="bg-gray-200 px-3 py-1 rounded">+</button>
                        <button onclick="removeFromCart(${item.id})" class="text-red-500 ml-3">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('cartTotal').textContent = `$${total.toFixed(2)}`;
        }

        function updateQuantity(itemId, change) {
            const item = cart.find(i => i.id === itemId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(itemId);
                } else {
                    renderCart();
                    updateCartCount();
                }
            }
        }

        function removeFromCart(itemId) {
            cart = cart.filter(i => i.id !== itemId);
            renderCart();
            updateCartCount();
        }

        function proceedToOrder() {
            if (cart.length === 0) {
                showNotification('Your cart is empty!', 'error');
                return;
            }
            closeCart();
            document.getElementById('tableModal').classList.add('active');
        }

        // Order History
        function openOrderHistory() {
            document.getElementById('orderHistoryModal').classList.add('active');
            renderOrderHistory();
        }

        function closeOrderHistory() {
            document.getElementById('orderHistoryModal').classList.remove('active');
        }

        function renderOrderHistory() {
            const container = document.getElementById('orderHistoryItems');
            if (!container) return;

            if (orderHistory.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No orders yet</p>';
                return;
            }
            
            container.innerHTML = orderHistory.map(order => {
                const statusClass = `status-${order.status}`;
                const lang = translations[order.language || 'en'];
                
                return `
                    <div class="border rounded-lg p-4 custom-bg">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="font-bold text-lg">Order #${order.id}</h3>
                                <p class="text-sm text-gray-600">${order.date}</p>
                                <p class="text-sm font-semibold">${order.tableNumber} - ${order.guestName}</p>
                                ${order.preferences ? `<div class="mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded"><p class="text-xs font-semibold text-yellow-800"><i class="fas fa-exclamation-triangle"></i> Allergies/Preferences:</p><p class="text-xs text-yellow-900">${order.preferences}</p></div>` : ''}
                            </div>
                            <div class="flex gap-2 items-center">
                                <span class="status-badge ${statusClass}">
                                    ${lang[order.status]}
                                </span>
                                ${currentRole === 'owner' || currentRole === 'kitchen' ? `
                                    <select onchange="updateOrderStatus(${order.id}, this.value)" class="px-2 py-1 border rounded text-sm">
                                        <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                                        <option value="preparing" ${order.status === 'preparing' ? 'selected' : ''}>Preparing</option>
                                        <option value="ready" ${order.status === 'ready' ? 'selected' : ''}>Ready</option>
                                        <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                                    </select>
                                ` : ''}
                            </div>
                        </div>
                        <div class="space-y-2 mb-3">
                            ${order.items.map(item => `
                                <div class="flex justify-between text-sm">
                                    <span>${item.name} x${item.quantity}</span>
                                    <span>$${(item.price * item.quantity).toFixed(2)}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="border-t pt-2 flex justify-between font-bold">
                            <span>Total:</span>
                            <span>$${order.total.toFixed(2)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Kitchen Panel
        function renderKitchenOrders() {
            const container = document.getElementById('kitchenOrders');
            if (!container) return;

            const activeOrders = orderHistory.filter(o => o.status !== 'delivered');
            
            if (activeOrders.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No active orders</p>';
                return;
            }
            
            container.innerHTML = activeOrders.map(order => {
                const statusClass = `status-${order.status}`;
                
                return `
                    <div class="border rounded-lg p-6 bg-white shadow-md">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-bold text-xl">Order #${order.id}</h3>
                                <p class="text-sm text-gray-600">${order.date}</p>
                                <p class="text-lg font-semibold mt-1">${order.tableNumber} - ${order.guestName}</p>
                                ${order.preferences ? `<div class="mt-2 p-3 bg-yellow-50 border-2 border-yellow-400 rounded-lg"><p class="text-sm font-bold text-yellow-800"><i class="fas fa-exclamation-triangle"></i> ALLERGIES/PREFERENCES:</p><p class="text-sm text-yellow-900 font-semibold mt-1">${order.preferences}</p></div>` : ''}
                            </div>
                            <span class="status-badge ${statusClass}">${order.status.toUpperCase()}</span>
                        </div>
                        <div class="space-y-2 mb-4">
                            ${order.items.map(item => `
                                <div class="flex justify-between text-lg">
                                    <span><strong>${item.name}</strong> x${item.quantity}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="flex gap-2">
                            <button onclick="updateOrderStatus(${order.id}, 'preparing')" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg font-semibold">
                                Start Preparing
                            </button>
                            <button onclick="updateOrderStatus(${order.id}, 'ready')" class="flex-1 bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg font-semibold">
                                Mark Ready
                            </button>
                            <button onclick="updateOrderStatus(${order.id}, 'delivered')" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-lg font-semibold">
                                Delivered
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function sendKitchenNotification() {
            const message = document.getElementById('kitchenNotificationInput').value;
            if (message) {
                showNotification(message, 'info', 10000);
                document.getElementById('kitchenNotificationInput').value = '';
            }
        }

        // Owner Panel
        function updateOwnerStats() {
            const total = orderHistory.length;
            const pending = orderHistory.filter(o => o.status === 'pending' || o.status === 'preparing').length;
            const completed = orderHistory.filter(o => o.status === 'delivered').length;
            const revenue = orderHistory.filter(o => o.status === 'delivered').reduce((sum, o) => sum + o.total, 0);
            
            document.getElementById('totalOrders').textContent = total;
            document.getElementById('pendingOrders').textContent = pending;
            document.getElementById('completedOrders').textContent = completed;
            document.getElementById('totalRevenue').textContent = `$${revenue.toFixed(2)}`;
        }

        function renderOwnerOrders() {
            const container = document.getElementById('ownerOrders');
            if(!container) return;
            container.innerHTML = orderHistory.map(order => {
                const statusClass = `status-${order.status}`;
                const lang = translations[order.language || 'en'];
                
                return `
                    <div class="border rounded-lg p-4 custom-bg">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="font-bold text-lg">Order #${order.id}</h3>
                                <p class="text-sm text-gray-600">${order.date}</p>
                                <p class="text-sm font-semibold">${order.tableNumber} - ${order.guestName}</p>
                            </div>
                            <div class="flex gap-2 items-center">
                                <span class="status-badge ${statusClass}">${lang[order.status]}</span>
                                <select onchange="updateOrderStatus(${order.id}, this.value)" class="px-2 py-1 border rounded text-sm">
                                    <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                                    <option value="preparing" ${order.status === 'preparing' ? 'selected' : ''}>Preparing</option>
                                    <option value="ready" ${order.status === 'ready' ? 'selected' : ''}>Ready</option>
                                    <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                                </select>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function sendOwnerNotification() {
            const message = document.getElementById('ownerNotificationInput').value;
            if (message) {
                showNotification(message, 'info', 10000);
                document.getElementById('ownerNotificationInput').value = '';
            }
        }

        // Notification System
        function showNotification(message, type = 'info', duration = 3000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'error' ? 'bg-red-500' : 
                           type === 'info' ? 'bg-blue-500' : 'bg-gray-500';
            
            notification.className = `notification ${bgColor} text-white px-6 py-4 rounded-lg shadow-lg`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, duration);
        }

        // Language Change
        function changeLanguage() {
            currentLanguage = document.getElementById('languageSelector').value;
            renderMenu();
            if (document.getElementById('cartModal').classList.contains('active')) {
                renderCart();
            }
        }

        // Image Upload Handlers
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('logoUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.getElementById('logoUrl').value = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('bgImageUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.body.style.backgroundImage = `url(${event.target.result})`;
                        document.body.style.backgroundSize = 'cover';
                        document.body.style.backgroundAttachment = 'fixed';
                    };
                    reader.readAsDataURL(file);
                }
            });

            document.getElementById('menuItemImage').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.getElementById('menuItemImagePreview').src = event.target.result;
                        document.getElementById('menuItemImagePreview').classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });

            init();
        });

        function removeBgImage() {
            document.body.style.backgroundImage = '';
            showNotification('Background image removed', 'success');
        }
    </script>
</body>
</html>
